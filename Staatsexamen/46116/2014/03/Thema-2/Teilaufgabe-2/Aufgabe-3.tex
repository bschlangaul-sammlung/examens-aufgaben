\documentclass{lehramt-informatik-aufgabe}
\InformatikPakete{syntax,rmodell,spalten}
\begin{document}

%-----------------------------------------------------------------------
%
%-----------------------------------------------------------------------

\section{Aufgabe 3: SQL
\index{SQL}
\footcite[Thema 2 Aufgabe 3]{examen:46116:2014:03}
}

{
\footnotesize
\begin{multicols}{2}
„Kunde":

\begin{tabular}{|l|l|l|l|}
\hline
\liPrimaer{KID} & Name & Vorname & \liFremd{Stadt}\\\hline\hline
K1 & Meier & Stefan & S3\\\hline
K2 & Müller & Peta & S3\\\hline
K3 & Schmidt & Christine & S2\\\hline
K4 & Schulz & Michael & S4\\\hline
\end{tabular}

„Stadt"

\begin{tabular}{|l|l|l|}
\hline
\liPrimaer{SID} & SName & Bundesland\\\hline\hline
S1 & Berlin & Berlin\\\hline
S2 & Nürnberg & Bayern\\\hline
S3 & Köln & Nordrhein-Wesffalen\\\hline
S4 & Stuttgart & Baden-Württemberg\\\hline
S5 & München & Bayern\\\hline
\end{tabular}
\end{multicols}

\begin{multicols}{2}
„Angebot":

\begin{tabular}{|l|l|l|l|l|}
\hline
\liPrimaer{KID} & \liFremd{Start} & \liFremd{Ziel} & \liPrimaer{Datum} & Plätze\\\hline\hline
K4 & S4 & S5 & 08.07.2011 & 3\\\hline
K4 & S5 & S4 & 10.07.2011 & 3\\\hline
K1 & S1 & S5 & 08.07.2011 & 3\\\hline
K3 & S2 & S3 & 15.07.2011 & 1\\\hline
K4 & S4 & S1 & 15.07.2011 & 3\\\hline
K1 & S5 & S5 & 09.07.2011 & 2\\\hline
\end{tabular}

„Anfrage":

\begin{tabular}{|l|l|l|l|}
\hline
\liPrimaer{KID} & \liFremd{Start} & \liFremd{Ziel} & \liPrimaer{Datum}\\\hline\hline
K2 & S4 & S5 & 08.07.2011\\\hline
K2 & S5 & S4 & 10.07.2011\\\hline
K3 & S2 & S3 & 08.07.2011\\\hline
K3 & S3 & S2 & 10.07.2011\\\hline
K2 & S4 & S5 & 05.07.2011\\\hline
K2 & S5 & S4 & 17.07.2011\\\hline
\end{tabular}
\end{multicols}
}

\begin{enumerate}
\item Formulieren Sie die folgenden Anfragen in SQL:\footcite{db:pu:wh}

\begin{enumerate}

%%
%
%%

\item Geben Sie alle Attribute aller Anfragen aus, für die passende
Angebote existieren! Ein Angebot ist passend zu einer Anfrage, wenn
Start, Ziel und Datum identisch sind!

\begin{antwort}
\begin{minted}{sql}
SELECT Anfrage.KID, Anfrage.Start, Anfrage.Ziel, Anfrage.Datum
FROM Anfrage, Angebot
WHERE
  Anfrage.Start = Angebot.Start AND
  Anfrage.Ziel = Angebot.Ziel AND
  Anfrage.Datum = Angebot.Datum;
\end{minted}
\end{antwort}

%%
%
%%

\item Finden Sie Nachnamen und Vornamen aller Kunden, für die kein
Angebot existiert!

\begin{antwort}
\begin{minted}{sql}
SELECT k.Name, k.Vorname
FROM Kunde k
WHERE NOT EXISTS ( SELECT * FROM Angebot a WHERE a.KID = k.KID )
\end{minted}

oder:

\begin{minted}{sql}
SELECT k.Name, k.Vorname
FROM Kunde k
WHERE k.KID NOT IN ( SELECT KID FROM Angebot );
\end{minted}
\end{antwort}

%%
%
%%

\item Geben Sie das Datum aller angebotenen Fahrten von München nach
Stuttgart aus und sortieren Sie das Ergebnis aufsteigend!

\begin{minted}{sql}
SELECT Datum
FROM Angebot, Stadt
WHERE
  (SID = Start OR
  SID = Ziel)
  AND
  (SName = 'München' OR SName = 'Stuttgart')
\end{minted}

%%
%
%%

\item Geben Sie für jeden Startort einer Anfrage den Namen der Stadt und
die Anzahl der Anfragen aus.

\begin{minted}{sql}
SELECT SName, COUNT(*)
FROM Anfrage, Stadt
WHERE SID = Start
GROUP BY SID;
\end{minted}

\end{enumerate}

\item Wie sieht die Ergebnisrelation zu folgenden Anfragen auf den
Beispieldaten aus?\index{GROUP BY}\index{HAVING}

\begin{minted}{sql}
SELECT *
FROM
Stadt
WHERE
NOT EXISTS ( SELECT *
FROM Anfrage
WHERE Start = SID OR Ziel = SID ) ;
\end{minted}

\begin{antwort}
S1 Berlin Berlin
\end{antwort}

\begin{minted}{sql}
SELECT KID, SUM (Plaetze)
FROM Angebot
WHERE Plaetze > 2
GROUP BY KID
HAVING SUM (Plaetze) > 4;
\end{minted}

\end{enumerate}
\end{document}
