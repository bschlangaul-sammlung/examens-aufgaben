\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{lehramt-informatik-kontrollflussgraph}[2020/11/07]
%    \end{macrocode}

% \liLets{
%   b = liBedingung,
%   c = liKontrollCode,
%   f = liBedingungFalsch,
%   k = liKontrollTextzeileKnoten,
%   p = liKontrollKnotenPfad,
%   w = liBedingungWahr,
% }

% \subsubsection{TeX-Markup-Beispiel}

% \begin{verbatim}
% \begin{liKontrollflussgraph}[xscale=1,yscale=-1.6]
% \node[knoten] at (0,0) (S) {S};
%
% \node[pin=\c{boolean resultat = false;}] at (0,1) (2) {2};
% \node[pin=\c{if (wort != null)}] at (0,2) (3) {3};
% \node[pin=\c{int laenge = wort.length;}] at (1,3) (4) {4};
% \node[pin=\c{if (laenge >= 2)}] at (1,4) (5) {5};
% \node[pin=\c{resultat = true; int i = 0;}] at (2,5) (6) {6};
% \node[pin=\c{for (i < laenge / 2;)}] at (2,6) (7) {7};
% \node[pin=\c{char c1; char c2 …}] at (3,7) (8) {8};
% \node[pin=\c{if (Char…) }] at (2,8) (10) {10};
% \node[pin=\c{resultat = false; break;}] at (2,9) (12) {12};
% \node[pin=\c{if (laenge == 1)}] at (1,10) (17) {17};
% \node[pin=\c{resultat = true;}] at (1,11) (18) {18};
% \node[pin=180:\c{return resultat;}] at (-1,9) (22) {22};
% \node[knoten] at (-1,10) (E) {E};
%
% \path (S) -- (2);
% \path (2) -- (3);
% \path[wahr] (3) -- (4) \b{right}{wort != null};
% \path[falsch] (3) -- (22)  \b{left}{wort == null};
% \path (4) -- (5);
% \path[wahr] (5) -- (6) \b{right}{laenge >= 2};
% \path[falsch] (5) -- (17) \b{left,rotate=70,pos=0.2}{laenge < 2};
% \path (6) -- (7);
% \path[wahr] (7) -- (8) \b{right}{i < laenge / 2};
% \path[falsch] (7) -- (22) \b{left}{i >= laenge / 2};
% \path (8) -- (10);
% \path[wahr] (10) -- (12) \b{right}{c != c};
% \path[falsch] (10) -- (7) \b{left,rotate=70,pos=0.8}{c == c};
% \path (12) -- (22);
% \path[wahr] (17) -- (18) \b{right}{laenge == 1};
% \path[falsch] (17) -- (22) \b{right,rotate=-20,pos=0.99}{laenge != 1};
% \path (18) -- (22);
% \path (22) -- (E);
% \end{liKontrollflussgraph}
% \end{verbatim}

%    \begin{macrocode}
\RequirePackage{tikz}
\usetikzlibrary{positioning}
\tikzset{
  li kontrollfluss/.style={
    knoten/.style={
      circle,
      draw
    },
    usebox/.style={
      draw,
      rectangle,
      font=\scriptsize,
      anchor=west,
      align=left,
    },
    bedingung/.style={
      midway,
      draw=none,
      font=\scriptsize
    },
    knotenbeschriftung/.style={
      draw,
      rectangle,
      midway,
      font=\scriptsize
    },
    wahr/.style={
      thick
    },
    falsch/.style={
      dashed
    },
    every node/.style={
      circle,
      draw,
    },
    every edge/.append style={
      every node/.style={
        draw=none,
        bedingung,
      }
    },
    every path/.style={
      draw,
      ->,
    },
    every pin/.style={
      draw,
      dotted,
      rectangle,
      pin position=right
    },
    every pin edge/.style={
      dotted,
      arrows=-,
    }
  }
}
%    \end{macrocode}

% \subsubsection{Umgebungen}

% \begin{environment}{liKontrollflussgraph}
%    \begin{macrocode}
\NewDocumentEnvironment { liKontrollflussgraph } { O{} } {
  \begin{tikzpicture}[
    li kontrollfluss,
    #1
  ]
} {
  \end{tikzpicture}
}
%    \end{macrocode}
% \end{environment}

% \subsubsection{Makros}

% \begin{macro}{\liAnweisung}
%    \begin{macrocode}
\def\liAnweisung#1(#2,#3){\node[knoten] at (#2,#3) (#1) {#1};}
%    \end{macrocode}
% \end{macro}

% \begin{macro}{\liBedingung}
% \liLet{b}{liBedingung}
%    \begin{macrocode}
\def\liBedingung#1#2{node[bedingung,#1]{[\texttt{#2}]}}
%    \end{macrocode}
% \end{macro}

% \begin{macro}{\liBedingungWahr}
% \liLet{w}{liBedingungWahr}
%    \begin{macrocode}
\def\liBedingungWahr#1{node[bedingung,#1]{\texttt{[true]}}}
%    \end{macrocode}
% \end{macro}

% \begin{macro}{\liBedingungFalsch}
% \liLet{f}{liBedingungFalsch}
%    \begin{macrocode}
\def\liBedingungFalsch#1{node[bedingung,#1]{\texttt{[false]}}}
%    \end{macrocode}
% \end{macro}

% \begin{macro}{\liKontrollCode}
% \liLet{c}{liKontrollCode}
%    \begin{macrocode}
\def\liKontrollCode#1{{\tiny\texttt{\textcolor{gray}{#1}}}}
%    \end{macrocode}
% \end{macro}

% \begin{macro}{\liKontrollTextzeileKnoten}
% \liLet{k}{liKontrollTextzeileKnoten}
%    \begin{macrocode}
\def\liKontrollTextzeileKnoten#1{\raisebox{-2pt}{\tikz[scale=0.5,transform shape] \node[draw,circle]{#1};}}
%    \end{macrocode}
% \end{macro}

% \begin{macro}{\liKontrollKnotenPfad}
% \liLet{p}{liKontrollKnotenPfad}
%    \begin{macrocode}
\ExplSyntaxOn
\NewDocumentCommand { \liKontrollKnotenPfad }{ m }
{
  \seq_set_split:Nnn \l_tmpa_seq { - } { #1 }
  \seq_set_map:NNn \l_tmpa_seq \l_tmpa_seq {\liKontrollTextzeileKnoten{##1}}
  \seq_use:Nn \l_tmpa_seq { ~-~~ }
}
\ExplSyntaxOff
%    \end{macrocode}
% \end{macro}

%    \begin{macrocode}
