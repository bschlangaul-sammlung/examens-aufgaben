\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{lehramt-informatik-normalformen}[2020/12/10
Hilfsmakros zum Setzen von Normalformen, Funktionalen Abhänigkeiten,
Attributhülle]
\liLadePakete{mathe}
\directlua{
  normalformen = require('lehramt-informatik-normalformen')
}

\def\liTeilen#1{
  \directlua{tex.print(normalformen.teilen('#1'))}
}

% \let\ah=\liAttributHuelle
% Regulärer Ausdruck zum Konvertieren
% AttrHülle\((.*)\)
% \\ah{$1}
\def\liAttributHuelleOhneMathe#1{\text{AttrHülle}(#1)}
\def\liAttributHuelle#1{
\ifmmode
  \liAttributHuelleOhneMathe{#1}
\else
  $\liAttributHuelleOhneMathe{#1}$
\fi
}

% \let\m=\liAttributMenge
\def\liAttributMenge#1{\{ \textit{#1} \}}

\NewDocumentEnvironment{ liAHuelle } { +b } {
  \begingroup
  \footnotesize
  \begin{multline*}
    #1
  \end{multline*}
  \endgroup
} { }

% Nur innerhalb von liAHuelle zu verwenden
% bzw. multline
% \let\ahL=\liAttributHuelleLinksReduktion
% \ahL{ursprüngliche linke Attributmenge}{ohne dieses Attribut}{Ergebnis}
\def\liAttributHuelleLinksReduktion#1#2#3{
  \shoveleft{
    \liAttributHuelleOhneMathe{FA, \liAttributMenge{\liAttributMenge{#1} - \liAttributMenge{#2}}} =
  } \\
  \shoveright{
    \liAttributMenge{#3}
  } \\
}

% \let\fa=\liFunktionaleAbhaengigkeit
% \liFunktionaleAbhaengigkeit{A, B -> C, D}
% \$(.*?) \\rightarrow (.*?)\$
% \\fa{$1 -> $2}
\def\liFunktionaleAbhaengigkeit#1{%
  \directlua{normalformen.drucke_funk_abhaengigkeit('#1')}%
}

% \liFunktionaleAbhaengigkeiten[F]{
%   M -> M;
%   M -> N;
%   V -> T, P, PN;
%   P -> PN;
% }
%
% \let\FA=\liFunktionaleAbhaengigkeiten
% Regulärer Ausdruck zum Konvertieren
% \\item \$(.*) \\rightarrow (.*)\$
% \$(.*) \\rightarrow (.*)\$
% $1 -> $2;
\NewDocumentCommand {\liFunktionaleAbhaengigkeiten} { O{FA} m } {
  \par
  \noindent
  #1 $= \{$
  \par
  \directlua{normalformen.drucke_funk_abhaengigkeiten('#2')}
  \par
  \noindent$\}$
}

% Regulärer Ausdruck zum Konvertieren
% \$(R.*)\((.*)\)\$
% \\liRelation[$1]{$2}
\NewDocumentCommand {\liRelation} { O{R} m } {
  #1(\textit{\,#2\,})
}
