% https://bitbucket.org/pavel_calado/tikz-er2/src/default/
% The tikz-er2 package.
% Ver. 1.0
% (c) PÃ¡vel Caldo
% January 2009

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{tikz-er2}[2009/01/31 Entity-relationship diagrams using the
Tikz library]

\RequirePackage{tikz}
\RequirePackage[normalem]{ulem}  % for the dashed underline

% for text un key attributes
\newcommand{\key}[1]{\underline{#1}}

% for text in discriminator attributes
\def\discriminator{\bgroup
  \ifdim\ULdepth=\maxdimen  % Set depth based on font, if not set already
  \settodepth\ULdepth{(j}\advance\ULdepth.4pt\fi
  \markoverwith{\kern.15em
  \vtop{\kern\ULdepth \hrule width .3em}%
  \kern.15em}\ULon}

\usetikzlibrary{shapes.geometric}
\usetikzlibrary{arrows}
\usetikzlibrary{fit}
\usetikzlibrary{shadows}
\usetikzlibrary{positioning}
\usetikzlibrary{math}

\tikzstyle{every entity} = []
\tikzstyle{every weak entity} = []
\tikzstyle{every attribute} = []
\tikzstyle{every relationship} = []
\tikzstyle{every link} = []
\tikzstyle{every isa} = []

\newdimen\er@distance@unit
\er@distance@unit=1cm

\tikzset{
  er distance/.code={\er@distance@unit=#1}
}

\tikzstyle{nearest} = [
  node distance=1.25\er@distance@unit,
]

\tikzstyle{nearer} = [
  node distance=1.4\er@distance@unit,
]

\tikzstyle{near} = [
  node distance=1.8\er@distance@unit,
]

\tikzstyle{normal} = [
  node distance=2.3\er@distance@unit,
]

\tikzstyle{far} = [
  node distance=3\er@distance@unit,
]

\tikzstyle{farer} = [
  node distance=4.2\er@distance@unit,
]

\tikzstyle{farest} = [
  node distance=6\er@distance@unit,
]

\tikzstyle{er2} = [
  normal
]

\tikzstyle{link} = [
  >=triangle 60,
  draw,
  every link,
]

\tikzstyle{total} = [
  link,
  very thick,
]

\tikzstyle{weak} = [
  double,
  double distance=1pt,
]

\tikzstyle{entity} = [
  rectangle,
  draw,
  black,
  minimum width=6em,
  minimum height=3em,
  align=center,
  every entity,
]
\tikzstyle{weak entity} = [
  entity,
  double,
  double distance=1pt,
  every weak entity,
]

\tikzstyle{attribute} = [
  ellipse,
  draw,
  black,
  minimum width=5em,
  minimum height=2em,
  align=center,
  every attribute,
]

\tikzstyle{key attribute} = [
  attribute,
  font=\bfseries
  %node contents={\key{#1}},
]

\tikzstyle{multi attribute} = [
  attribute,
  double,
  double distance=1pt,
]

\tikzstyle{derived attribute} = [
  attribute,
  dashed,
]

\tikzstyle{discriminator} = [
  attribute,
  font=\itshape
]

\tikzstyle{relationship} = [
  diamond,
  draw,
  black,
  minimum width=2em,
  minimum width=4em,
  aspect=2,
  align=center,
  every relationship,
]

% identifying relationship
\tikzstyle{ident relationship} = [
  relationship,
  double,
  double distance=1pt,
]

\tikzstyle{isa} = [
  isosceles triangle,
  isosceles triangle apex angle=60,
  shape border rotate=90,
  draw,
  black,
  minimum size=3em,
  every isa,
]

\tikzstyle{generalization} = [
  isa
]

\tikzstyle{specialization} = [
  isosceles triangle,
  isosceles triangle apex angle=60,
  shape border rotate=-90,
  draw,
  black,
  minimum size=3em,
  every isa,
]

\tikzset{
  er2 colorful/.style = {
    every entity/.style = {
      top color=white,
      bottom color=blue!30,
      draw=blue!50!black!100,
      drop shadow
    },
    every weak entity/.style = {
      drop shadow = {shadow xshift=.7ex,shadow yshift=-.7ex},
    },
    every attribute/.style = {
      top color=white,
      bottom color=yellow!20,
      draw=yellow,
      drop shadow,
    },
    every relationship/.style = {
      top color=white,
      bottom color=red!20,
      draw=red!50!black!100,
      drop shadow,
    },
    every isa/.style = {
      top color=white,
      bottom color=green!20,
      draw=green!50!black!100,
      drop shadow,
    },
  }
}
